<% friendable = current_user.friendable_for(user) %>

<% if friendable %>

  <% query_string_params = {
    :user_id => current_user.id,
    :initiator_id => friendable.initiator_id,
    :approver_id => friendable.approver_id
  } %>

  <% if friendable.is_a?(FriendRequest) && friendable.approver == current_user %>

    Friend Request:

    <%= link_to('Accept', friend_path(
      friendable,
      query_string_params
    ), :method => :put) %>

    <%= link_to('Reject', friend_path(
      friendable,
      query_string_params
    ), :method => :delete, :class => 'text-danger') %>

  <% elsif friendable.is_a?(FriendRequest) && friendable.initiator == current_user %>

    <%= link_to('Cancel Friend Request', friend_path(
      friendable,
      query_string_params
    ), :method => :delete, :class => 'text-danger') %>

  <% elsif friendable.is_a?(Friendship) %>

    <%= link_to('- Unfriend', friend_path(
      friendable,
      query_string_params
    ), :method => :delete, :class => 'text-danger') %>

  <% end %>

<% else %>

  <%= link_to('+ Add Friend', friends_path(
    friendable,
    :user_id => current_user.id,
    :initiator_id => current_user.id,
    :approver_id => user.id
  ), :method => :post) %>

<% end %>

